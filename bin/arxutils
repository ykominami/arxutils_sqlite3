#!/usr/bin/env ruby

require "arxutils_sqlite3"

# DBセットアップクラス
class Dbsetup
  def initialize(hash, opts)
    register_time = Arxutils_Sqlite3::Dbutil::DbMgr.init(
      hash["db_dir"],
      hash["migrate_dir"],
      hash["config_dir"],
      hash["dbconfig"],
      hash["env"],
      hash["log_fname"],
      opts
    )

    # 保存用DBマネージャ
    # @dbmgr = Dbutil::EnopMgr.new(register_time)
    # puts "@dbmgr=#{@dbmgr}"
  end
end

env = ENV.fetch("ENV", nil)
# env ||= "development"
env ||= "production"

opts = { db_dir: Arxutils_Sqlite3::Dbutil::DB_DIR }

opts["dbconfig"] = Arxutils_Sqlite3::Dbutil::DBCONFIG_SQLITE3 unless opts["dbconfig"]

hash = {
  "db_dir" => Arxutils_Sqlite3::Dbutil::DB_DIR,
  "migrate_dir" => Arxutils_Sqlite3::Dbutil::MIGRATE_DIR,
  "config_dir" => Arxutils_Sqlite3::Dbutil::CONFIG_DIR,
  "dbconfig" => opts["dbconfig"],
  "env" => env,
  "log_fname" => Arxutils_Sqlite3::Dbutil::DATABASELOG,
  :csv_fname => "x.csv",
  "output_dir" => "output"
}

dbsetup = Dbsetup.new(
  hash,
  opts
)
